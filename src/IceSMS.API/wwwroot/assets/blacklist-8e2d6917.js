import{r,j as e,u as G}from"./index-408549ef.js";import{k as Q,l as W,u as X,a as J,g as Z,b as ee,c as te,m as ae,T as se,d as ne,e as D,f as oe,h as _,i as re,j as F,D as ie}from"./data-table-pagination-74889f99.js";import{c as ce,u as le,b as L,P as de,d as ue,C as he,A as me,S as z,a as B,D as pe,e as xe,f as fe,g as be}from"./app-layout-10f771d5.js";import{u as ge,P as V,I as ke,B as E}from"./input-5d80ed27.js";import{u as ye,P as Ce,S as we,F as je,B as Se}from"./BulkAddSheet-a1c233ff.js";import{C as ve,a as Re}from"./card-d535f7d7.js";import{c as K}from"./utils-b13f04d9.js";import{c as T}from"./createLucideIcon-ccf82dc6.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Ee=T("Download",Ne);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Pe=T("Ellipsis",Te);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Me=T("Search",De);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Ae=T("Trash2",Ie);var I="Checkbox",[_e,Ge]=ce(I),[Fe,Le]=_e(I),H=r.forwardRef((s,h)=>{const{__scopeCheckbox:n,name:p,checked:l,defaultChecked:c,required:x,disabled:d,value:C="on",onCheckedChange:w,form:f,...j}=s,[u,k]=r.useState(null),S=ge(h,o=>k(o)),v=r.useRef(!1),R=u?f||!!u.closest("form"):!0,[i=!1,N]=le({prop:l,defaultProp:c,onChange:w}),P=r.useRef(i);return r.useEffect(()=>{const o=u==null?void 0:u.form;if(o){const t=()=>N(P.current);return o.addEventListener("reset",t),()=>o.removeEventListener("reset",t)}},[u,N]),e.jsxs(Fe,{scope:n,state:i,disabled:d,children:[e.jsx(V.button,{type:"button",role:"checkbox","aria-checked":g(i)?"mixed":i,"aria-required":x,"data-state":O(i),"data-disabled":d?"":void 0,disabled:d,value:C,...j,ref:S,onKeyDown:L(s.onKeyDown,o=>{o.key==="Enter"&&o.preventDefault()}),onClick:L(s.onClick,o=>{N(t=>g(t)?!0:!t),R&&(v.current=o.isPropagationStopped(),v.current||o.stopPropagation())})}),R&&e.jsx(ze,{control:u,bubbles:!v.current,name:p,value:C,checked:i,required:x,disabled:d,form:f,style:{transform:"translateX(-100%)"},defaultChecked:g(c)?!1:c})]})});H.displayName=I;var $="CheckboxIndicator",q=r.forwardRef((s,h)=>{const{__scopeCheckbox:n,forceMount:p,...l}=s,c=Le($,n);return e.jsx(de,{present:p||g(c.state)||c.state===!0,children:e.jsx(V.span,{"data-state":O(c.state),"data-disabled":c.disabled?"":void 0,...l,ref:h,style:{pointerEvents:"none",...s.style}})})});q.displayName=$;var ze=s=>{const{control:h,checked:n,bubbles:p=!0,defaultChecked:l,...c}=s,x=r.useRef(null),d=Q(n),C=ue(h);r.useEffect(()=>{const f=x.current,j=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(j,"checked").set;if(d!==n&&k){const S=new Event("click",{bubbles:p});f.indeterminate=g(n),k.call(f,g(n)?!1:n),f.dispatchEvent(S)}},[d,n,p]);const w=r.useRef(g(n)?!1:n);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l??w.current,...c,tabIndex:-1,ref:x,style:{...s.style,...C,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function g(s){return s==="indeterminate"}function O(s){return g(s)?"indeterminate":s?"checked":"unchecked"}var U=H,Be=q;const M=r.forwardRef(({className:s,...h},n)=>e.jsx(U,{ref:n,className:K("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...h,children:e.jsx(Be,{className:K("flex items-center justify-center text-current"),children:e.jsx(he,{className:"h-4 w-4"})})}));M.displayName=U.displayName;function Qe(){const[s,h]=r.useState([]),[n,p]=r.useState([]),[l,c]=r.useState({pageIndex:0,pageSize:10}),[x,d]=r.useState(""),[C,w]=r.useState({}),[f,j]=r.useState({}),u=G(),{toast:k}=ye(),S=W({mutationFn:async t=>{var b;const a=(b=document.cookie.split("; ").find(m=>m.startsWith("authToken=")))==null?void 0:b.split("=")[1];if(!a)throw new Error("Yetkilendirme hatası");const y=await fetch(`/api/v1/blacklist/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!y.ok)throw new Error("Silme işlemi başarısız");return y.json()},onSuccess:()=>{k({title:"Başarılı",description:"Kayıt başarıyla silindi"}),u.invalidateQueries({queryKey:["blacklist"]})},onError:()=>{k({title:"Hata",description:"Silme işlemi sırasında bir hata oluştu",variant:"destructive"})}}),v=t=>{window.confirm("Bu kaydı silmek istediğinize emin misiniz?")&&S.mutate(t)},R=[{id:"select",header:({table:t})=>e.jsx(M,{checked:t.getIsAllPageRowsSelected(),onCheckedChange:a=>t.toggleAllPageRowsSelected(!!a),"aria-label":"Tümünü seç"}),cell:({row:t})=>e.jsx(M,{checked:t.getIsSelected(),onCheckedChange:a=>t.toggleSelected(!!a),"aria-label":"Satır seç"}),enableSorting:!1,enableHiding:!1},{accessorKey:"phone",header:"Telefon Numarası",cell:({row:t})=>e.jsx("div",{className:"font-medium",children:t.getValue("phone")}),filterFn:"includesString"},{accessorKey:"tenant_id",header:"Tenant ID"},{accessorKey:"CreatedAt",header:"Eklenme Tarihi",cell:({row:t})=>new Date(t.getValue("CreatedAt")).toLocaleDateString()},{accessorKey:"UpdatedAt",header:"Güncelleme Tarihi",cell:({row:t})=>new Date(t.getValue("UpdatedAt")).toLocaleDateString()},{id:"actions",cell:({row:t})=>{const a=t.original;return e.jsxs(pe,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(E,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsx(fe,{align:"end",children:e.jsxs(be,{onClick:()=>v(a.ID),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Sil"]})})]})}}],{data:i,isLoading:N}=X({queryKey:["blacklist",l],queryFn:async()=>{var b;const t=(b=document.cookie.split("; ").find(m=>m.startsWith("authToken=")))==null?void 0:b.split("=")[1];if(!t)throw new Error("Yetkilendirme hatası");const a=new URLSearchParams({page:(l.pageIndex+1).toString(),limit:l.pageSize.toString()}),y=await fetch(`/api/v1/blacklist?${a}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!y.ok)throw new Error("API hatası");return y.json()}}),P=async()=>{var A;const t=(A=document.cookie.split("; ").find(Y=>Y.startsWith("authToken=")))==null?void 0:A.split("=")[1];if(!t)throw new Error("Yetkilendirme hatası");const a=await fetch("/api/v1/blacklist/export?fileType=CSV",{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Dışa aktarma başarısız");const y=await a.blob(),b=window.URL.createObjectURL(y),m=document.createElement("a");m.href=b,m.download=`karalist_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(b),document.body.removeChild(m)},o=J({data:(i==null?void 0:i.data)||[],columns:R,pageCount:(i==null?void 0:i.total_page)||-1,state:{pagination:l,sorting:s,columnFilters:n,globalFilter:x,rowSelection:C,columnVisibility:f},onPaginationChange:c,onSortingChange:h,onColumnFiltersChange:p,onGlobalFilterChange:d,onRowSelectionChange:w,onColumnVisibilityChange:j,manualPagination:!0,getCoreRowModel:Z(),getPaginationRowModel:ee(),getSortedRowModel:te(),getFilteredRowModel:ae(),enableSorting:!0,enableColumnFilters:!0,enableRowSelection:!0});return e.jsx(me,{title:"Kara Liste Yönetimi Sayfası",breadcrumbs:[{title:"Kara Liste Yönetimi",href:"/phonebook/blacklist"}],children:e.jsx(ve,{children:e.jsxs(Re,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 w-1/3",children:[e.jsx(Me,{className:"w-4 h-4 text-gray-500"}),e.jsx(ke,{placeholder:"Ara...",value:x,onChange:t=>d(t.target.value),className:"h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:P,children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"CSV İndir"]}),e.jsxs(z,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Tekli Ekle"]})}),e.jsx(we,{})]}),e.jsxs(z,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(E,{className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Toplu Ekle"]})}),e.jsx(Se,{})]})]})]}),N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(se,{children:[e.jsx(ne,{children:o.getHeaderGroups().map(t=>e.jsx(D,{children:t.headers.map(a=>e.jsx(oe,{className:"font-semibold",children:_(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx(re,{children:o.getRowModel().rows.length===0?e.jsx(D,{children:e.jsx(F,{colSpan:R.length,className:"h-24 text-center",children:"Kayıt bulunamadı."})}):o.getRowModel().rows.map(t=>e.jsx(D,{children:t.getVisibleCells().map(a=>e.jsx(F,{children:_(a.column.columnDef.cell,a.getContext())},a.id))},t.id))})]})}),e.jsx("div",{className:"mt-4",children:e.jsx(ie,{table:o})})]})]})})})}export{Qe as default};
